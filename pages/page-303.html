<section class="page-section" id="page-303">
    <div class="page-header">
        <div class="page-number">303</div>
        <div class="page-title">
            <h3>8.2.4 Cliffs si Exploding Gradients</h3>
            <span>Structuri Extreme in Suprafata de Cost</span>
        </div>
    </div>
    <div class="image-container">
        <img src="../book_page_jpg/page-303.jpg"
             alt="Pagina 303" class="page-image" onclick="zoomImage(this)">
    </div>
    <div class="explanation-content">

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Cliffs: Stanci in Suprafata de Cost</h4>
                <p>Retelele neurale cu multe straturi au adesea regiuni extrem de abrupte - adevarate <strong>stanci</strong> (cliffs) in suprafata de cost. Acestea rezulta din inmultirea multor weights mari. Un gradient update pe fata unei stanci poate arunca parametrii extrem de departe!</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon animation">âœ¨</div>
                        <span>Vizualizare: Cliff Structure</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="background: var(--bg-lighter); padding: 15px; border-radius: 8px;">
                                <div style="display: flex; justify-content: center; align-items: flex-end; height: 100px; gap: 5px;">
                                    <div style="width: 30px; height: 20px; background: var(--success);"></div>
                                    <div style="width: 30px; height: 25px; background: var(--success);"></div>
                                    <div style="width: 30px; height: 30px; background: var(--success);"></div>
                                    <div style="width: 30px; height: 95px; background: var(--warning);"></div>
                                    <div style="width: 30px; height: 90px; background: var(--warning);"></div>
                                    <div style="width: 30px; height: 30px; background: var(--success);"></div>
                                    <div style="width: 30px; height: 25px; background: var(--success);"></div>
                                </div>
                                <p style="text-align: center; color: var(--text-secondary); margin-top: 10px;">Suprafata de cost cu o "stanca" verticala</p>
                            </div>
                            <p style="color: var(--warning); margin-top: 15px;"><strong>Problema:</strong> Gradientul pe fata stancii e <strong>enorm</strong>. Un pas normal ar sari complet peste stanca in zona de cost ridicat!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>De Unde Vin Cliff-urile?</h4>
                <p>In retele deep, output-ul e un produs de multe matrici de weights. Daca toate weight-urile sunt mari in aceeasi directie, produsul explodeaza exponential. Miscari mici in spatiul parametrilor pot cauza schimbari <strong>enorme</strong> in output si deci in cost.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">ðŸŽ®</div>
                        <span>Exemplu: 10 Straturi</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="code-block">
# Exemplu simplificat
output = W1 @ W2 @ W3 @ ... @ W10 @ input

# Daca fiecare W are norma 1.5:
# output ~ 1.5^10 = 57.7x input

# Daca fiecare W are norma 2:
# output ~ 2^10 = 1024x input

# Gradientul urmeaza aceeasi logica - EXPLODEAZA!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Solutia: Gradient Clipping</h4>
                <p>Solutia traditionala pentru cliff-uri e <strong>gradient clipping</strong>: daca norma gradientului depaseste un prag, o reducem pastrind directia. Astfel, chiar daca suntem pe fata unei stanci, facem un pas mic in loc sa sarim complet peste ea.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">ðŸŽ®</div>
                        <span>Algoritm: Gradient Clipping</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="code-block">
# Gradient Clipping
max_norm = 1.0
grad_norm = torch.norm(gradient)

if grad_norm > max_norm:
    gradient = gradient * (max_norm / grad_norm)

# Acum gradient are norma <= max_norm
# Pastram DIRECTIA, reducem MAGNITUDINEA
                            </div>
                            <p style="color: var(--text-secondary); margin-top: 15px;">Aceasta tehnica e esentiala pentru antrenarea RNN-urilor si transformer-ilor!</p>
                        </div>
                    </div>
                </div>
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon reference">ðŸ“š</div>
                        <span>Vezi Figura 8.3</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <p style="color: var(--text-secondary);">Figura 8.3 ilustreaza cum gradient clipping previne "saritul" peste cliff. Fara clipping, update-ul ar duce parametrii in zona opusa a spatiului, cu cost potential foarte mare.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
