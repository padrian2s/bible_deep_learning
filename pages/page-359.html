<section class="page-section" id="page-359">
    <div class="page-header">
        <div class="page-number">359</div>
        <div class="page-title">
            <h3>Figura 9.9-9.10: Invariante Invatate si Downsampling</h3>
            <span>Pooling peste Canale si Stride</span>
        </div>
    </div>
    <div class="image-container">
        <img src="book_page_jpg/page-359.jpg"
             alt="Pagina 359" class="page-image" onclick="zoomImage(this)">
    </div>
    <div class="explanation-content">

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Figura 9.9: Invarianta la Rotatie prin Pooling peste Canale</h4>
                <p>Pooling-ul poate invata invariante mai complexe! Exemplul arata 3 filtre diferite, fiecare antrenat sa detecteze cifra "5" la o orientare usor diferita. Cand aplicam max pooling PESTE aceste 3 canale (nu spatial), obtinem invarianta la rotatie: indiferent de orientarea cifrei "5", unul din filtre va avea activare mare, iar pooling-ul va raporta aceasta activare.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon animation">âœ¨</div>
                        <span>Vizualizare: Pooling peste Orientari</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="text-align: center; padding: 20px; background: var(--bg-lighter); border-radius: 12px;">
                                <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2rem; transform: rotate(-15deg); background: var(--bg-dark); padding: 15px; border-radius: 8px;">5</div>
                                        <div style="margin-top: 5px; font-size: 0.8rem;">Filtru 1</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2rem; background: var(--success); padding: 15px; border-radius: 8px; font-weight: bold;">5</div>
                                        <div style="margin-top: 5px; font-size: 0.8rem;">Filtru 2</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2rem; transform: rotate(15deg); background: var(--bg-dark); padding: 15px; border-radius: 8px;">5</div>
                                        <div style="margin-top: 5px; font-size: 0.8rem;">Filtru 3</div>
                                    </div>
                                </div>
                                <div style="font-size: 1.5rem; margin: 10px 0;">â†“ max() peste canale â†“</div>
                                <div style="background: var(--accent); padding: 15px 40px; border-radius: 8px; display: inline-block;">
                                    <strong>Detectie "5" (invarianta la rotatie)</strong>
                                </div>
                            </div>
                            <p style="margin-top: 15px; color: var(--text-secondary); font-size: 0.9rem;">Aceasta tehnica este folosita in retelele <strong>Maxout</strong> (Goodfellow et al., 2013).</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Figura 9.10: Pooling cu Downsampling (Stride > 1)</h4>
                <p>In practica, pooling-ul se foloseste de obicei cu <strong>stride > 1</strong> pentru a reduce dimensiunea reprezentarii. Exemplul arata max pooling cu pool_width=3 si stride=2. Aceasta reduce numarul de unitati la jumatate, scazand costul computational si memoria necesara pentru straturile urmatoare.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon animation">âœ¨</div>
                        <span>Vizualizare: Pooling cu Stride</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="background: var(--bg-lighter); padding: 20px; border-radius: 12px;">
                                <div style="margin-bottom: 15px;">
                                    <strong>Input (6 valori):</strong>
                                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">0.1</div>
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">1.0</div>
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">0.2</div>
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">0.1</div>
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">0.0</div>
                                        <div style="background: var(--primary); padding: 15px 20px; border-radius: 4px;">0.1</div>
                                    </div>
                                </div>

                                <div style="text-align: center; margin: 15px 0;">
                                    <span style="background: var(--accent); padding: 5px 15px; border-radius: 4px;">Max Pool: width=3, stride=2</span>
                                </div>

                                <div>
                                    <strong>Output (3 valori):</strong>
                                    <div style="display: flex; gap: 15px; margin-top: 10px;">
                                        <div style="background: var(--success); padding: 15px 30px; border-radius: 4px; font-weight: bold;">1.0</div>
                                        <div style="background: var(--success); padding: 15px 30px; border-radius: 4px;">0.2</div>
                                        <div style="background: var(--success); padding: 15px 30px; border-radius: 4px;">0.1</div>
                                    </div>
                                </div>
                            </div>
                            <div class="key-concept" style="margin-top: 15px;">
                                <strong>Reducere:</strong> 6 valori â†’ 3 valori (factor 2x)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">ðŸŽ®</div>
                        <span>Simulare: Pooling cu Stride in PyTorch</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="code-block">
import torch
import torch.nn as nn

# Input: batch=1, channels=1, height=4, width=8
x = torch.randn(1, 1, 4, 8)
print("Input shape:", x.shape)  # [1, 1, 4, 8]

# MaxPool cu kernel=2, stride=2 (standard)
pool_standard = nn.MaxPool2d(kernel_size=2, stride=2)
out_standard = pool_standard(x)
print("Standard pool:", out_standard.shape)  # [1, 1, 2, 4]

# MaxPool cu kernel=3, stride=2 (overlapping)
pool_overlap = nn.MaxPool2d(kernel_size=3, stride=2, padding=1)
out_overlap = pool_overlap(x)
print("Overlapping pool:", out_overlap.shape)  # [1, 1, 2, 4]

# Global Average Pooling - reduce la 1x1
gap = nn.AdaptiveAvgPool2d((1, 1))
out_gap = gap(x)
print("Global pool:", out_gap.shape)  # [1, 1, 1, 1]
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
