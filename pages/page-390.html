<section class="page-section" id="page-390">
    <div class="page-header">
        <div class="page-number">390</div>
        <div class="page-title">
            <h3>10.1 Unfolding Computational Graphs</h3>
            <span>Desfasurarea Grafurilor Computationale</span>
        </div>
    </div>
    <div class="image-container">
        <img src="../book_page_jpg/page-390.jpg"
             alt="Pagina 390" class="page-image" onclick="zoomImage(this)">
    </div>
    <div class="explanation-content">

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Ce inseamna "Unfolding"?</h4>
                <p><strong>Unfolding</strong> (desfasurarea) transforma un graf ciclic intr-un graf aciclic prin "desfasurarea" lui in timp. Un RNN compact cu bucla devine o retea feedforward lunga unde fiecare pas de timp e un nod separat, dar toti nodii impart aceiasi parametri.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon animation">âœ¨</div>
                        <span>Vizualizare: Folded vs Unfolded</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center;">
                                <div style="background: var(--bg-lighter); padding: 20px; border-radius: 8px; text-align: center;">
                                    <strong style="color: var(--accent);">Graf Ciclic (Folded)</strong>
                                    <div style="margin: 15px 0; font-size: 2rem;">
                                        â†º s
                                    </div>
                                    <div style="font-family: monospace;">s<sup>(t)</sup> = f(s<sup>(t-1)</sup>; Î¸)</div>
                                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 10px;">Reprezentare compacta cu bucla</p>
                                </div>
                                <div style="background: var(--bg-lighter); padding: 20px; border-radius: 8px;">
                                    <strong style="color: var(--success);">Graf Aciclic (Unfolded)</strong>
                                    <div style="margin: 15px 0; font-family: monospace; font-size: 0.9rem;">
                                        s<sup>(...)</sup> â†’[f]â†’ s<sup>(t-1)</sup> â†’[f]â†’ s<sup>(t)</sup> â†’[f]â†’ s<sup>(t+1)</sup> â†’[f]â†’ s<sup>(...)</sup>
                                    </div>
                                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Acelasi f la fiecare pas, dar reprezentat explicit pentru fiecare timp</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">ðŸŽ®</div>
                        <span>Ecuatia Sistemului Dinamic</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="key-concept">
                                <h5>Forma clasica a unui sistem dinamic:</h5>
                                <div class="formula">s<sup>(t)</sup> = f(s<sup>(t-1)</sup>; Î¸)</div>
                                <p style="margin-top: 10px;">Unde s<sup>(t)</sup> este <strong>starea sistemului</strong> la timpul t.</p>
                            </div>
                            <p style="margin-top: 15px; color: var(--text-secondary);">Ecuatia 10.1 este <strong>recurenta</strong> pentru ca definitia lui s la timpul t face referire la aceeasi definitie la timpul t-1.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Desfasurarea pentru Ï„ pasi</h4>
                <p>Pentru un numar finit de pasi Ï„, putem aplica definitia recursiv. De exemplu, pentru Ï„ = 3: s<sup>(3)</sup> = f(f(f(s<sup>(0)</sup>; Î¸); Î¸); Î¸). Dupa desfasurare, expresia nu mai contine recurenta - este un graf aciclic traditional!</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">ðŸŽ®</div>
                        <span>Cod: Unfolding Manual</span>
                        <span class="arrow">â–¶</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="code-block">
                                <pre>import torch
import torch.nn as nn

# Definim functia de tranzitie
class TransitionFunction(nn.Module):
    def __init__(self, hidden_size):
        super().__init__()
        self.W = nn.Linear(hidden_size, hidden_size)

    def forward(self, s):
        return torch.tanh(self.W(s))

# Unfolding manual pentru tau=3 pasi
f = TransitionFunction(hidden_size=10)
s0 = torch.zeros(1, 10)  # stare initiala

# Aplicam recursiv
s1 = f(s0)      # s(1) = f(s(0))
s2 = f(s1)      # s(2) = f(s(1)) = f(f(s(0)))
s3 = f(s2)      # s(3) = f(s(2)) = f(f(f(s(0))))

# Toate folosesc acelasi f (parameter sharing!)
print(f"s0 shape: {s0.shape}")
print(f"s3 shape: {s3.shape}")  # Aceeasi dimensiune</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
