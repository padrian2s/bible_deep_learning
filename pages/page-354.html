<section class="page-section" id="page-354">
    <div class="page-header">
        <div class="page-number">354</div>
        <div class="page-title">
            <h3>9.3 Pooling</h3>
            <span>Introducere in Operatia de Pooling</span>
        </div>
    </div>
    <div class="image-container">
        <img src="book_page_jpg/page-354.jpg"
             alt="Pagina 354" class="page-image" onclick="zoomImage(this)">
    </div>
    <div class="explanation-content">

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Limitarile Echiviariantei</h4>
                <p>Convolutia este echivarianta la translatii, dar NU la alte transformari precum scalare sau rotatie. Pentru detectia de muchii, aceasta e perfect - muchiile apar peste tot in imagine. Dar pentru detectia fetelor, am vrea poate ca partea de sus a retelei sa caute sprancene, iar cea de jos barbii. In astfel de cazuri, partajarea globala a parametrilor nu e ideala.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon reference">üìö</div>
                        <span>Cand NU vrem partajare completa</span>
                        <span class="arrow">‚ñ∂</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="display: grid; gap: 10px;">
                                <div style="background: var(--bg-lighter); padding: 12px; border-radius: 8px; display: flex; gap: 15px; align-items: center;">
                                    <span style="font-size: 2rem;">üòä</span>
                                    <div>
                                        <strong>Detectia fetelor</strong>
                                        <p style="font-size: 0.85rem; margin: 0; color: var(--text-secondary);">Ochii sunt mereu sus, gura jos - locatia conteaza</p>
                                    </div>
                                </div>
                                <div style="background: var(--bg-lighter); padding: 12px; border-radius: 8px; display: flex; gap: 15px; align-items: center;">
                                    <span style="font-size: 2rem;">üì∏</span>
                                    <div>
                                        <strong>Imagini centrate</strong>
                                        <p style="font-size: 0.85rem; margin: 0; color: var(--text-secondary);">Daca stim ca obiectul e mereu centrat</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>Ce este Pooling-ul?</h4>
                <p>Un layer CNN tipic are trei etape: (1) Convolutie - produce activari liniare, (2) Activare neliniara (ReLU) - etapa "detector", (3) <strong>Pooling</strong> - modifica outputul. Pooling-ul inlocuieste outputul la o locatie cu o statistica sumara a vecinilor. Cel mai comun este <strong>max pooling</strong>, care raporteaza valoarea maxima dintr-o regiune.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon animation">‚ú®</div>
                        <span>Vizualizare: Cele 3 Etape ale unui Layer CNN</span>
                        <span class="arrow">‚ñ∂</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap;">
                                <div style="background: var(--primary); padding: 20px; border-radius: 8px; text-align: center; flex: 1; min-width: 120px;">
                                    <div style="font-size: 1.5rem;">1Ô∏è‚É£</div>
                                    <strong>Convolutie</strong>
                                    <p style="font-size: 0.8rem; margin-top: 5px;">Œ£(input √ó kernel)</p>
                                </div>
                                <div style="font-size: 1.5rem;">‚Üí</div>
                                <div style="background: var(--accent); padding: 20px; border-radius: 8px; text-align: center; flex: 1; min-width: 120px;">
                                    <div style="font-size: 1.5rem;">2Ô∏è‚É£</div>
                                    <strong>ReLU</strong>
                                    <p style="font-size: 0.8rem; margin-top: 5px;">max(0, x)</p>
                                </div>
                                <div style="font-size: 1.5rem;">‚Üí</div>
                                <div style="background: var(--success); padding: 20px; border-radius: 8px; text-align: center; flex: 1; min-width: 120px;">
                                    <div style="font-size: 1.5rem;">3Ô∏è‚É£</div>
                                    <strong>Pooling</strong>
                                    <p style="font-size: 0.8rem; margin-top: 5px;">max(regiune)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon simulation">üéÆ</div>
                        <span>Simulare: Max Pooling 2x2</span>
                        <span class="arrow">‚ñ∂</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div class="code-block">
import torch
import torch.nn.functional as F

# Feature map 4x4 (dupa conv + ReLU)
feature_map = torch.tensor([[
    [1., 3., 2., 4.],
    [5., 6., 1., 2.],
    [3., 2., 8., 1.],
    [1., 0., 3., 4.]
]]).unsqueeze(0)

# Max pooling 2x2 cu stride 2
output = F.max_pool2d(feature_map, kernel_size=2, stride=2)
print("Input 4x4:\n", feature_map.squeeze())
print("\nOutput 2x2:\n", output.squeeze())
# Output:
# [[6., 4.],
#  [3., 8.]]

# Fiecare celula output = max din regiunea 2x2
# 6 = max(1,3,5,6), 4 = max(2,4,1,2), etc.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-paragraph">
            <div class="paragraph-main" onclick="toggleParagraph(this)">
                <h4>De ce Pooling?</h4>
                <p>Pooling-ul ofera <strong>invarianta aproximativa la translatii mici</strong>. Daca inputul se muta cu un pixel, dar maximul din regiune ramane acelasi, outputul nu se schimba. Aceasta proprietate este utila cand ne intereseaza DACA o caracteristica exista, nu exact UNDE este. De asemenea, reduce dimensionalitatea si numarul de calcule.</p>
            </div>
            <div class="expandable-sections">
                <div class="section-tab">
                    <div class="section-header" onclick="toggleSection(this)">
                        <div class="section-icon reference">üìö</div>
                        <span>Beneficiile Pooling-ului</span>
                        <span class="arrow">‚ñ∂</span>
                    </div>
                    <div class="section-content">
                        <div class="section-body">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div style="background: var(--bg-lighter); padding: 15px; border-radius: 8px;">
                                    <strong style="color: var(--success);">Invarianta la translatii</strong>
                                    <p style="font-size: 0.85rem; margin-top: 8px;">Robustete la variatii mici de pozitie</p>
                                </div>
                                <div style="background: var(--bg-lighter); padding: 15px; border-radius: 8px;">
                                    <strong style="color: var(--accent);">Reducerea dimensiunii</strong>
                                    <p style="font-size: 0.85rem; margin-top: 8px;">2x2 pooling ‚Üí 4x mai putine valori</p>
                                </div>
                                <div style="background: var(--bg-lighter); padding: 15px; border-radius: 8px;">
                                    <strong style="color: var(--primary);">Mai putine calcule</strong>
                                    <p style="font-size: 0.85rem; margin-top: 8px;">Layerele urmatoare lucreaza cu inputuri mai mici</p>
                                </div>
                                <div style="background: var(--bg-lighter); padding: 15px; border-radius: 8px;">
                                    <strong style="color: var(--warning);">Receptive field mai mare</strong>
                                    <p style="font-size: 0.85rem; margin-top: 8px;">Layerele urmatoare "vad" mai mult din imagine</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
